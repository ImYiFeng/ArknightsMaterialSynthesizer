<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜æ—¥æ–¹èˆŸææ–™åˆæˆåˆ†æå™¨</title>
    <link rel="icon" href="/favicon.ico" type="image/svg+xml">
    <style>
        /* å˜é‡å®šä¹‰ */
        :root {
            --bg-color: #e0e5ec;
            --text-color: #2d4263;
            --primary-color: #5cb3cc;
            --secondary-color: #50e3c2;
            --scrollbar-color: rgba(58,123,213,0.3);
            --neumorph-shadow: 12px 12px 24px #bebebe, -12px -12px 24px #ffffff;
            --neumorph-inset: inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff;
        }

        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 1000px;
            margin: 0 auto;
            padding: 80px;
        }

        h2 {
            color: var(--text-color);
            margin: 0 0 20px 0;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-color);
            border-radius: 4px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes cardFloat {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes elementAppear {
            from { opacity: 0; transform: translateY(40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes cardAppear {
            0% { opacity: 0; transform: translateY(30px) rotateX(30deg); }
            100% { opacity: 1; transform: translateY(0) rotateX(0); }
        }

        @keyframes pulseGlow {
            from {
                text-shadow: 0 0 10px rgba(58,123,213,0.2);
                box-shadow: 8px 8px 16px #bebebe,
                        -8px -8px 16px #ffffff,
                            0 0 24px rgba(58,123,213,0.1);
            }
            to {
                text-shadow: 0 0 20px rgba(58,123,213,0.4);
                box-shadow: 12px 12px 24px #bebebe,
                        -12px -12px 24px #ffffff,
                            0 0 36px rgba(58,123,213,0.2);
            }
        }

        @keyframes inputFocus {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* é€šç”¨å®¹å™¨ */
        .container {
            display: grid;
            grid-gap: 30px;
            perspective: 1000px;
        }

        /* æ‹Ÿæ€åŸºç¡€ç±» */
        .neumorph {
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: var(--neumorph-shadow);
            padding: 30px;
            transition: all 0.3s ease;
        }

        .neumorph-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(224, 229, 236, 0.9);
            backdrop-filter: blur(8px);
            z-index: 1000;
            box-shadow: var(--neumorph-shadow);
            transition: all 0.3s ease;
        }

        .neumorph-footer {
            text-align: center;
            padding: 20px;
            margin-top: 50px;
            color: var(--text-color);
        }

        .neumorph-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9em;
        }

        /* é¡µçœ‰æ ·å¼ */
        .header-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 1.4em;
            margin: 0;
            color: var(--text-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .tutorial-btn {
            background-color: #f8bc31;
            color: #2d4263;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-color);
            font-size: 0.9em;
        }

        .social-icon {
            width: 24px;
            height: 24px;
            filter: grayscale(1) brightness(0.5);
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            filter: grayscale(0) brightness(1);
            transform: scale(1.1);
        }

        .scrolled-header {
            background: rgba(224, 229, 236, 0.7) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* é¡µè„šæ ·å¼ */
        .neumorph-footer {
            text-align: center;
            padding: 20px;
            margin-top: 50px;
            color: var(--text-color);
        }

        .neumorph-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9em;
        }

        /* è¡¨å•å…ƒç´  */
        textarea {
            width: calc(100% - 4px);
            height: 200px;
            background: var(--bg-color);
            border: none;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 2px;
            box-sizing: border-box;
            box-shadow: var(--neumorph-inset);
            resize: vertical;
            font-size: 14px;
            transition: box-shadow 0.3s;
        }

        textarea:focus {
            animation: inputFocus 0.6s ease-out;
            box-shadow: inset 6px 6px 12px #bebebe, 
                        inset -6px -6px 12px #ffffff;
        }

        input[type="number"] {
            width: 80px;
            padding: 10px;
            background: var(--bg-color);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: var(--neumorph-inset),
                        0 0 12px rgba(58,123,213,0.2);
        }

        .input-section {
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out backwards;
        }

        .retention-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .retention-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        /* æŒ‰é’®å’Œäº¤äº’å…ƒç´  */
        button {
            background: var(--primary-color);
            color: var(--text-color);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            box-shadow: var(--neumorph-shadow);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                120deg,
                transparent,
                rgba(255,255,255,0.4),
                transparent
            );
            transition: all 0.8s;
        }    

        button:hover {
            transform: scale(1.06) translateY(-4px) !important;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1) !important;
            box-shadow: 16px 16px 32px #bebebe,
                    -16px -16px 32px #ffffff,
                        0 8px 24px rgba(58,123,213,0.2);
        }
        
        button:hover::before {
            left: 100%;
        }

        button:active {
            transform: translateY(2px) scale(0.98);
            box-shadow: var(--neumorph-inset);
        }

        /* å¡ç‰‡å¸ƒå±€ç³»ç»Ÿ */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 16px 0;
        }

        .synthesis-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            background: var(--bg-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--neumorph-shadow);
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .synthesis-group h2 {
            grid-column: 1 / -1;
            color: var(--primary-color);
            margin: 0 0 15px 0;
            font-size: 1.3em;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(58,123,213,0.2);
        }

        .synthesis-group:nth-child(1) .synthesis-card {
            animation-delay: 0.2s;
        }
        
        .synthesis-group:nth-child(2) .synthesis-card {
            animation-delay: 0.4s;
        }

        .synthesis-group .synthesis-card:nth-child(n+2) {
            animation-delay: 0.6s;
        }

        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
            #importMessage {
            font-size: 14px;
            margin-left: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: var(--primary-color);
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(58,123,213,0.1);
        }

        /* ææ–™å¡ç‰‡ç»„ä»¶ */
        .synthesis-card {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--neumorph-shadow);
            transform-style: preserve-3d;
            transition: all 0.5s cubic-bezier(0.33, 1, 0.68, 1) !important;
            animation: cardAppear 0.6s ease-out backwards;
        }

        .synthesis-card:hover {
            transform: 
                scale(1.05) 
                translateY(-10px) 
                rotate3d(1, -0.5, 0, 8deg) 
                translateZ(10px) !important;
            z-index: 2;
            box-shadow: 16px 16px 32px #bebebe,
                    -16px -16px 32px #ffffff,
                        0 12px 24px rgba(58,123,213,0.15);
            cursor: pointer;
        }

        .synthesis-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            box-shadow: 0 16px 32px rgba(58,123,213,0.15);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .synthesis-card:hover::after {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .card-header h3 {
            margin: 0;
            font-size: 1.2em;
            color: var(--text-color);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            color: var(--primary-color);
            font-size: 0.9em;
            padding-top: 10px;
            border-top: 1px solid rgba(58,123,213,0.1);
        }

        /* ææ–™åˆ—è¡¨ç³»ç»Ÿ */
        .material-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .material-item img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .material-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.8);
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 5px 5px 10px #bebebe, -5px -5px 10px #ffffff;
        }

        .material-icon {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
            background: linear-gradient(145deg, #ffffff, #e0e5ec);
            padding: 4px;
            transition: all 0.3s ease;
            transform: translateZ(0);
        }

        .material-icon:hover {
            transform: scale(2.0) rotate(8deg);
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .material-row {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 10px 0;
        }

        /* æ€»è®¡æ˜¾ç¤º */
        .total-cost {
            font-size: 1.2em;
            color: var(--primary-color);
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* å…¨å±€æ€»è§ˆæ ·å¼ */
        .global-total {
            position: relative;
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
            color: var(--primary-color);
            border-radius: 15px;
            box-shadow: var(--neumorph-shadow);
            background: linear-gradient(-45deg, 
                rgba(58,123,213,0.1), 
                rgba(80,227,194,0.1));
            background-size: 400% 400%;
            animation: 
                pulseGlow 2s ease-in-out infinite alternate,
                gradientBG 8s ease infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (prefers-reduced-motion: no-preference) {
            .synthesis-group {
                scroll-margin-top: 20px;
            }
            
            .synthesis-group {
                animation: fadeInUp 0.6s ease-out backwards;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-gap: 20px;
                padding: 15px;
            }
            
            .retention-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="neumorph-header">
        <div class="header-content">
            <div class="header-left">
                <h1>æ˜æ—¥æ–¹èˆŸææ–™åˆæˆåˆ†æå™¨</h1>
            </div>
            <div class="header-right">
                <span>by: ImYiFeng</span>
                <a href="https://github.com/ImYiFeng" target="_blank">
                    <img src="icon/github.svg" 
                         alt="GitHub" class="social-icon">
                </a>
                <a href="https://space.bilibili.com/386145794" target="_blank">
                    <img src="icon/bilibili.svg" 
                         alt="å“”å“©å“”å“©" class="social-icon">
                </a>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="input-section neumorph" style="animation: elementAppear 0.8s ease-out">
            <h2>ğŸ› ï¸ ä¼é¹…ç‰©æµæ•°æ®å¯¼å…¥</h2>
            <textarea id="jsonInput" placeholder="ç²˜è´´ä¼é¹…ç‰©æµåˆ·å›¾è§„åˆ’çš„ä»“åº“æ•°æ®..."></textarea>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top:20px;">
                <div>
                    <button onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <div id="importMessage"></div>
                </div>
                <button class="tutorial-btn" onclick="window.open('https://github.com/ImYiFeng/ArknightsMaterialSynthesizer/blob/main/README.md')">
                    ğŸ“˜ ä½¿ç”¨æ•™ç¨‹
                </button>
            </div>
        </div>
        <div class="neumorph retention-section" style="animation: elementAppear 0.8s ease-out 0.1s backwards">
            <h2 style="grid-column: 1 / -1;">ğŸ”’ ææ–™ä¿ç•™è®¾ç½®</h2>
            <div class="retention-item">
                <label>ç™½è‰²ææ–™ä¿ç•™:</label>
                <input type="number" id="retention1" value="0" min="0">
            </div>
            <div class="retention-item">
                <label>ç»¿è‰²ææ–™ä¿ç•™:</label>
                <input type="number" id="retention2" value="0" min="0">
            </div>
            <div class="retention-item">
                <label>è“è‰²ææ–™ä¿ç•™:</label>
                <input type="number" id="retention3" value="0" min="0">
            </div>
            <div class="retention-item">
                <label>ç´«è‰²ææ–™ä¿ç•™:</label>
                <input type="number" id="retention4" value="0" min="0">
            </div>
        </div>

        <button onclick="analyze()" class="neumorph" style="padding: 20px; font-size: 1.1em; background-color: #83cbac; animation: elementAppear 0.8s ease-out 0.2s backwards;">âœ¨ å¼€å§‹åˆ†æ</button>

        <div id="resultOutput" style="position: relative;"></div>
    </div>

    <script>
        const materialRank = {
            // T1
            'æºå²©': 1, 'ç ´æŸè£…ç½®': 1, 'é…¯åŸæ–™': 1, 'ä»£ç³–': 1, 'å¼‚é“ç¢ç‰‡': 1, 'åŒé…®': 1,
            // T2
            'å›ºæºå²©': 2, 'è£…ç½®': 2, 'èšé…¸é…¯': 2, 'ç³–': 2, 'å¼‚é“': 2, 'é…®å‡é›†': 2,
            // T3
            'ç¯çƒƒèšè´¨': 3, 'è½¬è´¨ç›ç»„': 3, 'è¤ç´ çº¤ç»´': 3, 'åŒ–åˆåˆ‡å‰Šæ¶²': 3, 'åŠè‡ªç„¶æº¶å‰‚': 3,
            'æ™¶ä½“å…ƒä»¶': 3, 'ç‚½åˆé‡‘': 3, 'å‡èƒ¶': 3, 'æ‰­è½¬é†‡': 3, 'è½»é”°çŸ¿': 3, 'ç ”ç£¨çŸ³': 3,
            'RMA70-12': 3, 'å›ºæºå²©ç»„': 3, 'å…¨æ–°è£…ç½®': 3, 'èšé…¸é…¯ç»„': 3, 'ç³–ç»„': 3,
            'å¼‚é“ç»„': 3, 'é…®å‡é›†ç»„': 3,
            // T4
            'ç¯çƒƒé¢„åˆ¶ä½“': 4, 'è½¬è´¨ç›èšå—': 4, 'å›ºåŒ–çº¤ç»´æ¿': 4, 'åˆ‡å‰ŠåŸæ¶²': 4, 'ç²¾ç‚¼æº¶å‰‚': 4,
            'æ™¶ä½“ç”µè·¯': 4, 'ç‚½åˆé‡‘å—': 4, 'èšåˆå‡èƒ¶': 4, 'ç™½é©¬é†‡': 4, 'ä¸‰æ°´é”°çŸ¿': 4,
            'äº”æ°´ç ”ç£¨çŸ³': 4, 'RMA70-24': 4, 'æçº¯æºå²©': 4, 'æ”¹é‡è£…ç½®': 4, 'èšé…¸é…¯å—': 4,
            'ç³–èšå—': 4, 'å¼‚é“å—': 4, 'é…®é˜µåˆ—': 4,
            // T5
            'çƒ§ç»“æ ¸å‡æ™¶': 5, 'æ™¶ä½“ç”µå­å•å…ƒ': 5, 'D32é’¢': 5, 'åŒæçº³ç±³ç‰‡': 5, 'èšåˆå‰‚': 5
        };
    
        const recipes = {
            'çƒ§ç»“æ ¸å‡æ™¶': {materials: {'è½¬è´¨ç›èšå—': 1, 'åˆ‡å‰ŠåŸæ¶²': 1, 'ç²¾ç‚¼æº¶å‰‚': 2}, cost: 400, mood: 8},
            'æ™¶ä½“ç”µå­å•å…ƒ': {materials: {'æ™¶ä½“ç”µè·¯': 1, 'èšåˆå‡èƒ¶': 2, 'ç‚½åˆé‡‘å—': 1}, cost: 400, mood: 8},
            'D32é’¢': {materials: {'ä¸‰æ°´é”°çŸ¿': 1, 'äº”æ°´ç ”ç£¨çŸ³': 1, 'RMA70-24': 1}, cost: 400, mood: 8},
            'åŒæçº³ç±³ç‰‡': {materials: {'æ”¹é‡è£…ç½®': 1, 'ç™½é©¬é†‡': 2}, cost: 400, mood: 8},
            'èšåˆå‰‚': {materials: {'æçº¯æºå²©': 1, 'å¼‚é“å—': 1, 'é…®é˜µåˆ—': 1}, cost: 400, mood: 8},
            'è½¬è´¨ç›èšå—': {materials: {'è½¬è´¨ç›ç»„': 1, 'åŠè‡ªç„¶æº¶å‰‚': 1, 'ç³–ç»„': 1}, cost: 300, mood: 4},
            'ç²¾ç‚¼æº¶å‰‚': {materials: {'åŠè‡ªç„¶æº¶å‰‚': 1, 'åŒ–åˆåˆ‡å‰Šæ¶²': 1, 'å‡èƒ¶': 1}, cost: 300, mood: 4},
            'åˆ‡å‰ŠåŸæ¶²': {materials: {'åŒ–åˆåˆ‡å‰Šæ¶²': 1, 'æ™¶ä½“å…ƒä»¶': 1, 'RMA70-12': 1}, cost: 300, mood: 4},
            'æ™¶ä½“ç”µè·¯': {materials: {'æ™¶ä½“å…ƒä»¶': 2, 'å‡èƒ¶': 1, 'ç‚½åˆé‡‘': 1}, cost: 300, mood: 4},
            'ç‚½åˆé‡‘å—': {materials: {'å…¨æ–°è£…ç½®': 1, 'ç ”ç£¨çŸ³': 1, 'ç‚½åˆé‡‘': 1}, cost: 300, mood: 4},
            'èšåˆå‡èƒ¶': {materials: {'å¼‚é“ç»„': 1, 'å‡èƒ¶': 1, 'ç‚½åˆé‡‘': 1}, cost: 300, mood: 4},
            'RMA70-24': {materials: {'RMA70-12': 1, 'å›ºæºå²©ç»„': 2, 'é…®å‡é›†ç»„': 1}, cost: 300, mood: 4},
            'äº”æ°´ç ”ç£¨çŸ³': {materials: {'ç ”ç£¨çŸ³': 1, 'å¼‚é“ç»„': 1, 'å…¨æ–°è£…ç½®': 1}, cost: 300, mood: 4},
            'ä¸‰æ°´é”°çŸ¿': {materials: {'è½»é”°çŸ¿': 2, 'èšé…¸é…¯ç»„': 1, 'æ‰­è½¬é†‡': 1}, cost: 300, mood: 4},
            'ç™½é©¬é†‡': {materials: {'æ‰­è½¬é†‡': 1, 'ç³–ç»„': 1, 'RMA70-12': 1}, cost: 300, mood: 4},
            'è£…ç½®': {materials: {'ç ´æŸè£…ç½®': 3}, cost: 100, mood: 1},
            'å…¨æ–°è£…ç½®': {materials: {'è£…ç½®': 4}, cost: 200, mood: 2},
            'æ”¹é‡è£…ç½®': {materials: {'å…¨æ–°è£…ç½®': 1, 'å›ºæºå²©ç»„': 2, 'ç ”ç£¨çŸ³': 1}, cost: 300, mood: 4},
            'é…®å‡é›†': {materials: {'åŒé…®': 3}, cost: 100, mood: 1},
            'é…®å‡é›†ç»„': {materials: {'é…®å‡é›†': 4}, cost: 200, mood: 2},
            'é…®é˜µåˆ—': {materials: {'é…®å‡é›†ç»„': 2, 'ç³–ç»„': 1, 'è½»é”°çŸ¿': 1}, cost: 300, mood: 4},
            'å¼‚é“': {materials: {'å¼‚é“ç¢ç‰‡': 3}, cost: 100, mood: 1},
            'å¼‚é“ç»„': {materials: {'å¼‚é“': 4}, cost: 200, mood: 2},
            'å¼‚é“å—': {materials: {'å¼‚é“ç»„': 2, 'å…¨æ–°è£…ç½®': 1, 'èšé…¸é…¯ç»„': 1}, cost: 300, mood: 4},
            'èšé…¸é…¯': {materials: {'é…¯åŸæ–™': 3}, cost: 100, mood: 1},
            'èšé…¸é…¯ç»„': {materials: {'èšé…¸é…¯': 4}, cost: 200, mood: 2},
            'èšé…¸é…¯å—': {materials: {'èšé…¸é…¯ç»„': 2, 'é…®å‡é›†ç»„': 1, 'æ‰­è½¬é†‡': 1}, cost: 300, mood: 4},
            'ç³–': {materials: {'ä»£ç³–': 3}, cost: 100, mood: 1},
            'ç³–ç»„': {materials: {'ç³–': 4}, cost: 200, mood: 2},
            'ç³–èšå—': {materials: {'ç³–ç»„': 2, 'å¼‚é“ç»„': 1, 'è½»é”°çŸ¿': 1}, cost: 300, mood: 4},
            'å›ºæºå²©': {materials: {'æºå²©': 3}, cost: 100, mood: 1},
            'å›ºæºå²©ç»„': {materials: {'å›ºæºå²©': 5}, cost: 200, mood: 2},
            'æçº¯æºå²©': {materials: {'å›ºæºå²©ç»„': 4}, cost: 300, mood: 4}
        };
    
        // çŠ¶æ€ç®¡ç†å˜é‡
        let currentMaterials = {};
        const messageDuration = 3000;
    
        // å¯¼å…¥æ•°æ®
        function importData() {
        const jsonInput = document.getElementById('jsonInput');
        const messageElement = document.getElementById('importMessage');
        messageElement.style.opacity = 0;
    
            try {
                const jsonStr = jsonInput.value.trim();
                if (!jsonStr) throw new Error('è¯·è¾“å…¥æ•°æ®');
                
                const data = JSON.parse(jsonStr);
                if (data['@type'] !== '@penguin-statistics/depot') {
                    throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                }

                currentMaterials = data.items.reduce((acc, item) => {
                    if (materialRank[item.name]) {
                        acc[item.name] = item.have || 0;
                    }
                    return acc;
                }, {});

                showMessage(`âœ… æˆåŠŸå¯¼å…¥${Object.keys(currentMaterials).length}é¡¹æ•°æ®`, true);
                jsonInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†

            } catch (error) {
                showMessage(`âŒ é”™è¯¯ï¼š${error.message}`, false);
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(text, isSuccess) {
            const messageElement = document.getElementById('importMessage');
            messageElement.textContent = text;
            messageElement.style.color = isSuccess ? '#3a7bd5' : '#e74c3c';
            messageElement.style.backgroundColor = isSuccess ? 'rgba(58,123,213,0.1)' : 'rgba(231,76,60,0.1)';
            
            messageElement.style.opacity = 1;
            setTimeout(() => {
                messageElement.style.opacity = 0;
            }, messageDuration);
        }
    
        // åˆ†æå‡½æ•°
        function analyze() {
            if (Object.keys(currentMaterials).length === 0) {
                showMessage('âš ï¸ è¯·å…ˆå¯¼å…¥åº“å­˜æ•°æ®', false);
                return;
            }
            const retention = {
                1: parseInt(document.getElementById('retention1').value) || 0,
                2: parseInt(document.getElementById('retention2').value) || 0,
                3: parseInt(document.getElementById('retention3').value) || 0,
                4: parseInt(document.getElementById('retention4').value) || 0
            };
    
            // æ‹·è´å½“å‰åº“å­˜
            const materials = JSON.parse(JSON.stringify(currentMaterials));
            const steps = [];
            let totalCost = 0;
            let totalMood = 0;
    
            // æŒ‰ç­‰çº§ä»ä½åˆ°é«˜å¤„ç†
            [1, 2, 3, 4].forEach(currentRank => {
                const currentMats = Object.keys(materialRank)
                    .filter(mat => materialRank[mat] === currentRank);
    
                currentMats.forEach(mat => {
                    // è·å–æ‰€æœ‰éœ€è¦å½“å‰ææ–™çš„é…æ–¹
                    const products = Object.keys(recipes)
                        .filter(product => recipes[product].materials[mat]);
    
                    // æŒ‰äº§å“åº“å­˜å‡åºæ’åº
                    products.sort((a, b) => (materials[a] || 0) - (materials[b] || 0));
    
                    products.forEach(product => {
                        const recipe = recipes[product];
                        const required = recipe.materials;
    
                        // è®¡ç®—æœ€å¤§å¯åˆæˆæ¬¡æ•°
                        let minTimes = Infinity;
                        Object.keys(required).forEach(rm => {
                            const rmRank = materialRank[rm] || 0;
                            const reserve = rmRank !== 0 ? retention[rmRank] || 0 : 0;
                            const current = materials[rm] || 0;
                            const available = Math.max(current - reserve, 0);
                            const times = Math.floor(available / required[rm]);
                            
                            if (times < minTimes) {
                                minTimes = times;
                            }
                        });
    
                        if (minTimes <= 0 || minTimes === Infinity) return;
    
                        // æ‰§è¡Œåˆæˆ
                        Object.keys(required).forEach(rm => {
                            materials[rm] = (materials[rm] || 0) - required[rm] * minTimes;
                        });
                        materials[product] = (materials[product] || 0) + minTimes;
    
                        // è®°å½•æ­¥éª¤
                        const cost = recipe.cost * minTimes;
                        const mood = recipe.mood * minTimes;
                        steps.push({
                            product,
                            times: minTimes,
                            materials: {...required},
                            cost,
                            mood
                        });
                        totalCost += cost;
                        totalMood += mood;
                    });
                });
            });
    
            displayResult(steps, totalCost, totalMood);
        }

        // ç»“æœæ˜¾ç¤º
        function displayResult(steps, totalCost, totalMood) {
            const resultContainer = document.getElementById('resultOutput');
            resultContainer.innerHTML = '';

            // æŒ‰ç­‰çº§åˆ†ç»„ï¼ˆä»ä½åˆ°é«˜æ’åºï¼‰
            const grouped = steps.reduce((acc, step) => {
                const rank = materialRank[step.product] || 0;
                if (rank >= 2) {
                    if (!acc[rank]) acc[rank] = [];
                    acc[rank].push(step);
                }
                return acc;
            }, {});

            // æŒ‰ç­‰çº§ä»ä½åˆ°é«˜æ’åº
            const sortedRanks = Object.keys(grouped).map(Number).sort((a, b) => a - b);
            
            // å¡ç‰‡ç”Ÿæˆé€»è¾‘
            sortedRanks.forEach((rank, groupIndex) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'synthesis-group';
                groupDiv.innerHTML = `<h2>${['ç™½è‰²','ç»¿è‰²','è“è‰²','ç´«è‰²','é‡‘è‰²'][rank-1]}ææ–™</h2>`;

                grouped[rank].forEach((step, index) => {
                    const card = createResultCard(step);
                    card.style.animation = `elementAppear 0.6s ease-out ${groupIndex * 0.3 + index * 0.1}s backwards`;
                    groupDiv.appendChild(card);
                });

                resultContainer.appendChild(groupDiv);
            });

            // æ€»æ¶ˆè€—æ˜¾ç¤º
            const totalDiv = document.createElement('div');
            totalDiv.className = 'global-total';
            totalDiv.textContent = `ğŸ·ï¸ æ€»æ¶ˆè€—ï¼šğŸ’° ${totalCost} é¾™é—¨å¸ | â¤ï¸ ${totalMood} å¿ƒæƒ…`;
            resultContainer.appendChild(totalDiv);
        }

        // åˆ›å»ºç»“æœå¡ç‰‡ç»„ä»¶
        function createResultCard(step) {
            const card = document.createElement('div');
            card.className = 'synthesis-card';
            card.innerHTML = `
                <div class="card-header">
                    <img src="pic/${step.product}.png" class="material-icon" 
                        onerror="this.onerror=null;this.src='placeholder.png'">
                    <h3>${step.product} Ã—${step.times}</h3>
                </div>
                <div class="material-list">
                    ${Object.entries(step.materials).map(([mat, count]) => `
                        <div class="material-item">
                            <img src="pic/${mat}.png" 
                                onerror="this.onerror=null;this.src='placeholder.png'">
                            <span>${count * step.times}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="card-footer">
                    <span class="cost">ğŸ’° ${step.cost}</span>
                    <span class="mood">â¤ï¸ ${step.mood}</span>
                </div>
            `;
            return card;
        }

        // æ·»åŠ æ»šåŠ¨ç›‘å¬
        window.addEventListener('scroll', () => {
            const header = document.querySelector('.neumorph-header');
            header.classList.toggle('scrolled-header', window.scrollY > 50);
        });
    </script>
    <footer class="neumorph-footer">
        <a href="https://github.com/ImYiFeng" target="_blank">Â©2025 ImYiFeng, All rights reserved.</a>
    </footer>
</body>
</html>